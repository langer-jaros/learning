# Database with PHP
Basics of PDO and how to use it

## MENU
+ [Initialize the database](#initialize-the-database)
+ [Problem with keywords](#problem-with-keywords)
+ [Create table](#create-table)
+ [Sql queries](#sql-queries)
+ [Insert into database](#insert-into-database)
+ [Get autogenerated Id](#get-autogenerated-id)
+ [Fetching](#fetching)

## Initialize the database
```
$db = Db::get();
```
---
## Problem with keywords
### To avoid mess with keywords use these: **\` \`**  
```
$db->query('DROP TABLE IF EXISTS `account`;');
```
---
## Create table
```
$db->query('
    CREATE TABLE IF NOT EXISTS `account` (
        id INTEGER PRIMARY KEY,
        number VARCHAR(10),
        code VARCHAR(4)
    );
');
```
---
## Sql queries
### (good practice)
```
$statement = $db->prepare('
    SELECT * 
    FROM `transaction` 
    WHERE `transaction`.`from` = :id OR `transaction`.`to` = :id;
');

$statement->execute(['id' => $this->getId()]);
```
---
## Insert into database
### (more safely)
```
$statement = $db->prepare('
    INSERT INTO `account`(number, code) 
    VALUES (:number,:code);
');

$statement->execute([
    'number' => $number,
    'code' => $code
]);
```
[source](https://phpdelusions.net/pdo_examples/insert)

---
## Get autogenerated Id
### after insert
```
$id = $db->lastInsertId();
```
---
## Fetching
```
$statement->fetch(); // next row
$statement->fetch(PDO::FETCH_ASSOC); 
// next row with specified indexing
$statement->fetchAll(PDO::FETCH_ASSOC); //array of all rows
```
[source](https://secure.php.net/manual/en/pdostatement.fetch.php)

### Fetching to the class object
```
$from = $statement->fetchObject('App\Model\Account', ['id', 'number', 'code']);
```
[source1](https://www.php.net/manual/en/pdostatement.fetchobject.php)
[source2](https://phpdelusions.net/pdo/objects)

### Fetching like array of objects
```
$statement->fetchAll(\PDO::FETCH_CLASS, 'App\Model\Transaction', ['id', 'from', 'to', 'amount']);
```
---
```10/11/2019, Jaroslav Langer```
